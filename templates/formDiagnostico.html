<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="shortcut icon" href="{{url_for('static',filename='imagenes/logo1.png')}}" type="image/x-icon">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <title>Consultorio Médico</title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/estilosCuestionario.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/estilos3.css')}}">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    

</head>

<body>
    <!-- <div class="container mt-5 mb-4">
        <div class="card">
            <h2 class="card-header text-center">Diagnostico de paciente: {{ datosP[1] }} {{ datosP[2] }} {{ datosP[3] }}</h2>
            <div class="card-body">
                <form id="contactForm" method="post" action="/GuardarDiagnostico">
                    <div class="form-group">
                        <label>1. ¿El paciente tiene síntomas gastrointestinales?</label>
                        <select class="form-control" id="symptoms1" onchange="showNextQuestion(this, 'question2', 'question9')">
                            <option value="">Seleccionar</option>
                            <option value="si">Sí</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div id="question2" style="display: none;">
                        <div class="form-group">
                            <label>2. ¿Ha experimentado el paciente dolor abdominal?</label>
                            <select class="form-control" id="symptoms2" onchange="showNextQuestion(this, 'question3', 'question5')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question3" style="display: none;">
                        <div class="form-group">
                            <label>3. ¿El dolor abdominal es crónico y recurrente?</label>
                            <select class="form-control" id="symptoms3" onchange="showNextQuestion(this, 'Enfermedad de Crohn', 'question4')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question5" style="display: none;">
                        <div class="form-group">
                            <label>5. ¿El paciente tiene diarrea crónica?</label>
                            <select class="form-control" id="symptoms5" onchange="showNextQuestion(this, 'question6', 'question8')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question6" style="display: none;">
                        <div class="form-group">
                            <label>6. ¿La diarrea se asocia con sangre o moco en las heces?</label>
                            <select class="form-control" id="symptoms6" onchange="showResult('Enfermedad de Crohn')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question8" style="display: none;">
                        <div class="form-group">
                            <label>8. ¿El paciente tiene estreñimiento crónico o irregularidades en los movimientos intestinales?</label>
                            <select class="form-control" id="symptoms8" onchange="showNextQuestion(this, 'question10', 'otherConditions')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question9" style="display: none;">
                        <div class="form-group">
                            <label>9. ¿El paciente tiene síntomas de infección respiratoria?</label>
                            <select class="form-control" id="symptoms9" onchange="showNextQuestion(this, 'question10', 'question11')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question10" style="display: none;">
                        <div class="form-group">
                            <label>10. ¿El paciente tiene fiebre alta, tos y fatiga extrema?</label>
                            <select class="form-control" id="symptoms10" onchange="showResult('Gripe')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question11" style="display: none;">
                        <div class="form-group">
                            <label>11. ¿El paciente ha experimentado sangrado de las encías?</label>
                            <select class="form-control" id="symptoms11" onchange="showNextQuestion(this, 'question12', 'otherConditions')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="question12" style="display: none;">
                        <div class="form-group">
                            <label>12. ¿El paciente tiene inflamación y enrojecimiento en las encías?</label>
                            <select class="form-control" id="symptoms12" onchange="showResult('Gingivitis')">
                                <option value="">Seleccionar</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>
                    <div id="otherConditions" style="display: none;">
                        <p>Otras condiciones a evaluar.</p>
                    </div>
                    <input type="hidden" name="paciente_id" value="{{ datosP[0] }}">
                    <button type="submit" class="btn btn-primary">Enviar</button>
                </form>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script>
        function showNextQuestion(selectElement, nextQuestionId, alternativeQuestionId) {
            var selectedOption = selectElement.value;
            if (selectedOption === "si") {
                $('#' + nextQuestionId).show();
                $('#' + alternativeQuestionId).hide();
            } else {
                $('#' + alternativeQuestionId).show();
                $('#' + nextQuestionId).hide();
            }
        }
        
        function showResult(result) {
            alert("El diagnóstico es: " + result);
            // Aquí podrías enviar el resultado a través de AJAX o realizar alguna otra acción con él
        }
        </script> -->
        {% set mensajes = get_flashed_messages() %}
{% if mensajes %}
    {% for msj in mensajes %}
        <script>
        {% if 'Success' in mensajes %}
            Swal.fire(
            'Exploracion y Diagnostico Generado!!',
            'La exploración y diagnostico se guardo correctamente!!',
            'success'
            );
        {% endif %}
        </script>
        <script>
        {% if '' in mensajes %}
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'No se pueden guardar campos vacios!',
        })
        {% endif %}
        </script>
    {% endfor %}
{% endif %}
        <form action="/GuardarDiagnostico" method="post" id="cuestionarioForm">
            <h1>Cuestionario</h1>
            <label for="pregunta1">¿Has presenciado fiebre?</label>
            <select name="pregunta1">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta2">¿Sientes dolor en el abdomen?</label>
            <select name="pregunta2">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta3">¿Has tenido varias evacuaciones?</label>
            <select name="pregunta3">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta4">¿Has bajado de peso de forma sospechosa?</label>
            <select name="pregunta4">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta5">¿Tienes dolor en las encías?</label>
            <select name="pregunta5">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta6">¿Has sangrado de las encías?</label>
            <select name="pregunta6">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta7">¿Has tenido congestión nasal?</label>
            <select name="pregunta7">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta8">¿Has tenido dolor muscular?</label>
            <select name="pregunta8">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta9">¿Tienes problemas para tragar?</label>
            <select name="pregunta9">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta10">¿Has sentido náuseas?</label>
            <select name="pregunta10">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta11">¿Tienes mal aliento aún al lavarte los dientes?</label>
            <select name="pregunta11">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    
            <label for="pregunta12">¿Tienes las encías retraídas?</label>
            <select name="pregunta12">
                <option value="--">--</option>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br><br>
    

            <div class="resultados" id="resultados">
                <h2>Resultados</h2>
                <p id="enfermedadPrincipal">Enfermedad Principal:</p>
                <input type="hidden" name="txtDiagnostico" id="txtDiagnostico_input" value="null">
                <input type="hidden" name="paciente_id" id="txtPaciente_input" value="{{ datosP[0] }}">
                <p id="enfermedadAlternativa">Enfermedad Alternativa:</p>
            </div>
            <input type="submit" value="Enviar">
        </form>
    
        
    
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const form = document.getElementById('cuestionarioForm');
                const resultadosDiv = document.getElementById('resultados');
                const enfermedadPrincipalP = document.getElementById('enfermedadPrincipal');
                const enfermedadAlternativaP = document.getElementById('enfermedadAlternativa');
    
                form.addEventListener('submit', function (event) {
                    <!-- event.preventDefault(); -->
    
                    //Obtener respuestas del formulario
                    const respuestas = {};
                    for (const select of form.querySelectorAll('select')) {
                        respuestas[select.name] = select.value;
    
                        //Verificar que haya una respuesta válida (Sí o No)
                        if (select.value !== 'si' && select.value !== 'no') {
                            alert('Por favor, responde todas las preguntas');
                            return; //Salir de la función si hay una respuesta inválida
                        }
                    }
    
                    //Lógica para sumar valores de enfermedades
                    let valorGripe = 0;
                    let valorCrohn = 0;
                    let valorGingivitis = 0;
    
                    for (const pregunta in respuestas) {
                        const respuesta = respuestas[pregunta];
    
                        if (respuesta === 'si') {
                            //Asignar valores a las enfermedades según la lógica deseada
                            if (pregunta === 'pregunta1') {
                                valorGripe += 3;
                                valorCrohn += 2;
                                valorGingivitis += 1;
                            } else if (pregunta === 'pregunta2') {
                                valorGripe += 1;
                                valorCrohn += 3;
                            } else if (pregunta === 'pregunta3') {
                                valorGripe += 1;
                                valorCrohn += 3;
                            } else if (pregunta === 'pregunta4') {
                                valorCrohn += 1;
                            } else if (pregunta === 'pregunta5') {
                                valorGingivitis += 2;
                            } else if (pregunta === 'pregunta6') {
                                valorGingivitis += 3;
                            } else if (pregunta === 'pregunta7') {
                                valorGripe += 3;
                            } else if (pregunta === 'pregunta8') {
                                valorGripe += 2;
                                valorCrohn += 1;
                            } else if (pregunta === 'pregunta9') {
                                valorCrohn += 1;
                            } else if (pregunta === 'pregunta10') {
                                valorGripe += 2;
                                valorCrohn += 1;
                            } else if (pregunta === 'pregunta11') {
                                valorGingivitis += 3; // Recién agregado
                            } else if (pregunta === 'pregunta12') {
                                valorGingivitis += 3; // Recién agregado
                            }
                        }
                    }
    
                    //Calcular porcentajes
                    const total = valorGripe + valorCrohn + valorGingivitis;
                    const porcentajeGripe = (valorGripe / total) * 100;
                    const porcentajeCrohn = (valorCrohn / total) * 100;
                    const porcentajeGingivitis = (valorGingivitis / total) * 100;
                    console.log("Gripe: ", porcentajeGripe, "\nCrohn: ", porcentajeCrohn, "\nGingivitis: ",porcentajeGingivitis);
    
                    //Determinar enfermedad principal y alternativa
                    let enfermedadPrincipal = '';
                    let enfermedadAlternativa = '';
    
                    if (porcentajeGripe >= porcentajeCrohn && porcentajeGripe >= porcentajeGingivitis) {
                        enfermedadPrincipal = 'Gripe';
                        enfermedadPrincipalP.textContent = `Enfermedad Principal: ${enfermedadPrincipal} (${porcentajeGripe.toFixed(2)}%)`;
                        var txtDiagnostico = document.getElementById("txtDiagnostico_input");
                        txtDiagnostico.value = enfermedadPrincipal;
                        enfermedadAlternativa = (porcentajeCrohn >= porcentajeGingivitis) ? 'Crohn' : 'Gingivitis';
                        enfermedadAlternativaP.textContent =  `Enfermedad Alternativa: ${enfermedadAlternativa} (${Math.max(porcentajeCrohn, porcentajeGingivitis).toFixed(2)}%)`;
    
                    } else if (porcentajeCrohn >= porcentajeGingivitis) {
                        enfermedadPrincipal = 'Crohn';
                        enfermedadPrincipalP.textContent = `Enfermedad Principal: ${enfermedadPrincipal} (${porcentajeCrohn.toFixed(2)}%)`;
                        var txtDiagnostico = document.getElementById("txtDiagnostico_input");
                        txtDiagnostico.value = enfermedadPrincipal;
                        enfermedadAlternativa = (porcentajeGripe >= porcentajeGingivitis) ? 'Gripe' : 'Gingivitis';
                        enfermedadAlternativaP.textContent =  `Enfermedad Alternativa: ${enfermedadAlternativa} (${Math.max(porcentajeGripe, porcentajeGingivitis).toFixed(2)}%)`;
                    } else {
                        enfermedadPrincipal = 'Gingivitis';
                        enfermedadPrincipalP.textContent = `Enfermedad Principal: ${enfermedadPrincipal} (${porcentajeGingivitis.toFixed(2)}%)`;
                        var txtDiagnostico = document.getElementById("txtDiagnostico_input");
                        txtDiagnostico.value = enfermedadPrincipal;
                        enfermedadAlternativa = (porcentajeGripe >= porcentajeCrohn) ? 'Gripe' : 'Crohn';
                        enfermedadAlternativaP.textContent =  `Enfermedad Alternativa: ${enfermedadAlternativa} (${Math.max(porcentajeGripe, porcentajeCrohn).toFixed(2)}%)`;
                    }
    
                    //Mostrar resultados
                    // enfermedadPrincipalP.textContent = `Enfermedad Principal: ${enfermedadPrincipal} (${Math.max(porcentajeGripe, porcentajeCrohn, porcentajeGingivitis).toFixed(2)}%)`;
                    // enfermedadAlternativaP.textContent = `Enfermedad Alternativa: ${enfermedadAlternativa} (${Math.(porcentajeGripe, porcentajeCrohn, porcentajeGingivitis).toFixed(2)}%)`;
                    resultadosDiv.style.display = 'block';
                });
            });
        </script>
</body>

</html>